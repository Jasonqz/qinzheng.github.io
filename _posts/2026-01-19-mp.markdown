---
layout:       post
title:        "Java常见项目问题"
author:       "qinzheng"
header-style: text
catalog:      true
tags:
    - Java
    - 线程
---

**单据防止重复提交**

1，前端防重复提交：在点击提交按钮后，禁用按钮并显示一个加载中的提示，等待服务器返回结果后再启用按钮。

2，Token机制防重：将业务类型和Token拼接成的字符串作为key,整个单据的信息作为value,在点击下一步的的时候将key,value存入redis中，提交的时候再进行校验，如果Token失效，则表示重复提交。

3，中台防重复提交：利用redis,确认转账信息时生成一个防重流水号，点击提交的时候给这个这个流水号加锁，设置60秒的超时时间，获取锁的等待时间3秒，如果短时间内有两次提交，那么第二次点击获取不到锁就会直接失败。

4，后台幂等性校验：使用幂等表、自定义注解、切面和通知。利用环绕通知指定了切入点表达式，匹配被`@Idempotent`注解修饰的方法，通过反射的方式，后台在处理单据之前先将单据号作为唯一流水号插入幂等表中，如果有两笔提交的单号相同，那么第二次提交将会直接报错。

5，数据库层面：单据表的单号作为唯一索引，相同的单号插入会报错。



**ThreadLocal是啥？有哪些应用场景？**

ThreadLocal是Java中的一个类，它提供了线程本地变量，这些变量与其他普通变量的区别在于，每个访问该变量的线程都有其自己的独立初始化的变量副本。ThreadLocal通常被用来解决多线程并发访问时的数据安全问题，因为它提供了一种线程隔离的方式，保证了每个线程的数据互不干扰。

ThreadLocal的应用场景包括：

线程池---解决并发安全问题

web程序--减少方法调用参数的传递

数据库---降低数据库连接的开销

**哪些地方用到队列？**

1，**任务调度与并发处理**：队列常用于任务调度和并发处理。例如，可以使用`ExecutorService`和`BlockingQueue`来实现线程池，其中`BlockingQueue`用于存储待执行的任务。线程从队列中取出任务并执行，从而实现并发处理。

2，**消息传递与异步通信**：在分布式系统中，队列常用于消息传递和异步通信。例如，使用RabbitMQ、Kafka等消息队列中间件，可以实现系统间的解耦和异步消息传递。

3，**缓冲处理**：队列可以作为缓冲区，用于平滑数据流。例如，在高并发的场景下，可以使用队列来缓存请求或响应，从而避免系统瞬时崩溃。

4，**数据同步与顺序保证**：队列可以用于不同线程之间的数据同步，并保证数据的顺序性。例如，一个线程负责向队列中添加数据，另一个线程负责从队列中取出数据，从而实现线程间的数据共享和顺序处理。

5，**广度优先搜索（BFS）**：在算法中，队列常用于广度优先搜索。通过队列的FIFO（先进先出）特性，可以方便地实现层次遍历。

6，**生产者-消费者模型**：队列在生产者-消费者模型中起到关键作用。生产者将数据放入队列，消费者从队列中取出数据进行处理，从而实现生产者和消费者之间的解耦。
